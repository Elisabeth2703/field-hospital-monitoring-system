{% extends 'base.html' %}

{% block title %}–û–±–ª–∞–¥–Ω–∞–Ω–Ω—è - –ü–æ–ª—å–æ–≤–∏–π –ì–æ—Å–ø—ñ—Ç–∞–ª—å ‚Ññ7{% endblock %}

{% block extra_css %}
<style>
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(0,0,0,0.12);
    }

    .stat-info h3 {
        font-size: 14px;
        color: #8896a4;
        font-weight: 500;
        margin-bottom: 10px;
    }

    .stat-info .stat-value {
        font-size: 36px;
        font-weight: 700;
        color: #2c3e50;
    }

    .stat-icon {
        font-size: 48px;
    }

    .toolbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        gap: 20px;
        flex-wrap: wrap;
    }

    .search-box {
        flex: 1;
        max-width: 500px;
        position: relative;
    }

    .search-box input {
        width: 100%;
        padding: 14px 20px 14px 50px;
        border: 2px solid #e8edf2;
        border-radius: 10px;
        font-size: 15px;
        transition: border-color 0.3s;
    }

    .search-box input:focus {
        outline: none;
        border-color: #4a90e2;
    }

    .search-box::before {
        content: 'üîç';
        position: absolute;
        left: 18px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 18px;
        pointer-events: none;
    }

    .btn {
        padding: 14px 28px;
        border: none;
        border-radius: 10px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s;
        text-decoration: none;
    }

    .btn-primary {
        background: #4a90e2;
        color: white;
    }

    .btn-primary:hover {
        background: #357abd;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
    }

    .filter-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }

    .filter-btn {
        padding: 10px 20px;
        border: 2px solid #e8edf2;
        background: white;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        color: #5a6c7d;
        transition: all 0.3s;
        text-decoration: none;
        display: inline-block;
    }

    .filter-btn.active {
        background: #4a90e2;
        color: white;
        border-color: #4a90e2;
    }

    .filter-btn:hover {
        border-color: #4a90e2;
    }

    .table-container {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        overflow-x: auto;
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    thead {
        background: #f8fafb;
    }

    th {
        padding: 18px 20px;
        text-align: left;
        font-size: 13px;
        font-weight: 600;
        color: #8896a4;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    tbody tr {
        border-bottom: 1px solid #f1f3f5;
        transition: background 0.2s;
    }

    tbody tr:hover {
        background: #f8fafb;
    }

    tbody tr:last-child {
        border-bottom: none;
    }

    td {
        padding: 20px;
        font-size: 15px;
        color: #2c3e50;
    }

    .badge {
        display: inline-block;
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 600;
        white-space: nowrap;
    }

    .badge.excellent {
        background: #e8f8f5;
        color: #27ae60;
    }

    .badge.good {
        background: #e3f2fd;
        color: #2196f3;
    }

    .badge.fair {
        background: #fff3e0;
        color: #f39c12;
    }

    .badge.poor {
        background: #ffe5e5;
        color: #e74c3c;
    }

    .badge.broken {
        background: #f8d7da;
        color: #721c24;
    }

    .badge.available {
        background: #e8f8f5;
        color: #27ae60;
    }

    .badge.in-use {
        background: #fff3e0;
        color: #f39c12;
    }

    .badge.maintenance {
        background: #e3f2fd;
        color: #2196f3;
    }

    .badge.out-of-service {
        background: #ffe5e5;
        color: #e74c3c;
    }

    .actions {
        display: flex;
        gap: 10px;
        align-items: center;
    }

    .btn-icon {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        transition: all 0.2s;
        text-decoration: none;
        background: transparent;
    }

    .btn-icon.view {
        background: #e3f2fd;
        color: #2196f3;
    }

    .btn-icon.edit {
        background: #fff3e0;
        color: #f39c12;
    }

    .btn-icon.delete {
        background: #ffe5e5;
        color: #e74c3c;
    }

    .btn-icon:hover {
        transform: scale(1.1);
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #8896a4;
    }

    .empty-state-icon {
        font-size: 64px;
        margin-bottom: 20px;
    }

    .empty-state h3 {
        font-size: 20px;
        margin-bottom: 10px;
        color: #5a6c7d;
    }

    .empty-state p {
        font-size: 15px;
    }

    @media (max-width: 768px) {
        .toolbar {
            flex-direction: column;
            align-items: stretch;
        }

        .search-box {
            max-width: 100%;
        }

        .btn {
            justify-content: center;
        }

        .table-container {
            overflow-x: scroll;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Stats -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-info">
            <h3>–í—Å—å–æ–≥–æ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è</h3>
            <div class="stat-value">{{ equipment|length }}</div>
        </div>
        <div class="stat-icon">üîß</div>
    </div>

    <div class="stat-card">
        <div class="stat-info">
            <h3>–î–æ—Å—Ç—É–ø–Ω–æ</h3>
            <div class="stat-value" style="color: #27ae60;">
                {{ available_count|default:0 }}
            </div>
        </div>
        <div class="stat-icon">‚úÖ</div>
    </div>

    <div class="stat-card">
        <div class="stat-info">
            <h3>–í –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ</h3>
            <div class="stat-value" style="color: #f39c12;">
                {{ in_use_count|default:0 }}
            </div>
        </div>
        <div class="stat-icon">‚öôÔ∏è</div>
    </div>

    <div class="stat-card">
        <div class="stat-info">
            <h3>–ü–æ—Ç—Ä–µ–±—É—î —Ä–µ–º–æ–Ω—Ç—É</h3>
            <div class="stat-value" style="color: #e74c3c;">
                {{ maintenance_count|default:0 }}
            </div>
        </div>
        <div class="stat-icon">‚ö†Ô∏è</div>
    </div>
</div>

<!-- Toolbar -->
<div class="toolbar">
    <form method="get" class="search-box" action="">
        <input type="text" 
               name="search" 
               placeholder="–ü–æ—à—É–∫ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è –∑–∞ –Ω–∞–∑–≤–æ—é –∞–±–æ —à—Ç—Ä–∏—Ö-–∫–æ–¥–æ–º..." 
               value="{{ search_query|default:'' }}">
    </form>
    <a href="{% url 'equipment_create' %}" class="btn btn-primary">
        ‚ûï –î–æ–¥–∞—Ç–∏ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è
    </a>
</div>

<!-- Filters -->
<div class="filter-buttons">
    <a href="{% url 'equipment_list' %}" class="filter-btn {% if not request.GET.filter %}active{% endif %}">
        –í—Å—ñ
    </a>
    <a href="?filter=available" class="filter-btn {% if request.GET.filter == 'available' %}active{% endif %}">
        –î–æ—Å—Ç—É–ø–Ω—ñ
    </a>
    <a href="?filter=in-use" class="filter-btn {% if request.GET.filter == 'in-use' %}active{% endif %}">
        –í –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ
    </a>
    <a href="?filter=maintenance" class="filter-btn {% if request.GET.filter == 'maintenance' %}active{% endif %}">
        –ù–∞ —Ä–µ–º–æ–Ω—Ç—ñ
    </a>
    <a href="?filter=broken" class="filter-btn {% if request.GET.filter == 'broken' %}active{% endif %}">
        –ù–µ—Å–ø—Ä–∞–≤–Ω—ñ
    </a>
</div>

<!-- Table -->
<div class="table-container">
    <table>
        <thead>
            <tr>
                <th>–ù–∞–∑–≤–∞</th>
                <th>–®—Ç—Ä–∏—Ö-–∫–æ–¥</th>
                <th>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</th>
                <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å</th>
                <th>–°—Ç–∞–Ω</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫</th>
                <th>–û—Å—Ç–∞–Ω–Ω—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞</th>
                <th>–î—ñ—ó</th>
            </tr>
        </thead>
        <tbody>
            {% for eq in equipment %}
            <tr>
                <td><strong>{{ eq.name }}</strong></td>
                <td>{{ eq.barcode }}</td>
                <td>{{ eq.category|default:"-" }}</td>
                <td>{{ eq.quantity }} {{ eq.unit|default:"—à—Ç" }}</td>
                <td>
                    {% if eq.condition == 'excellent' %}
                        <span class="badge excellent">–í—ñ–¥–º—ñ–Ω–Ω–∏–π</span>
                    {% elif eq.condition == 'good' %}
                        <span class="badge good">–î–æ–±—Ä–∏–π</span>
                    {% elif eq.condition == 'fair' %}
                        <span class="badge fair">–ó–∞–¥–æ–≤—ñ–ª—å–Ω–∏–π</span>
                    {% elif eq.condition == 'poor' %}
                        <span class="badge poor">–ü–æ–≥–∞–Ω–∏–π</span>
                    {% elif eq.condition == 'broken' %}
                        <span class="badge broken">–ù–µ—Å–ø—Ä–∞–≤–Ω–∏–π</span>
                    {% else %}
                        <span class="badge good">{{ eq.condition }}</span>
                    {% endif %}
                </td>
                <td>
                    {% if eq.status == 'available' %}
                        <span class="badge available">–î–æ—Å—Ç—É–ø–Ω–æ</span>
                    {% elif eq.status == 'in-use' %}
                        <span class="badge in-use">–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è</span>
                    {% elif eq.status == 'maintenance' %}
                        <span class="badge maintenance">–ù–∞ —Ä–µ–º–æ–Ω—Ç—ñ</span>
                    {% elif eq.status == 'out-of-service' %}
                        <span class="badge out-of-service">–í–∏–≤–µ–¥–µ–Ω–æ –∑ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó</span>
                    {% else %}
                        <span class="badge available">{{ eq.status }}</span>
                    {% endif %}
                </td>
                <td>{{ eq.supplier|default:"-" }}</td>
                <td>
                    {% if eq.last_maintenance %}
                        {{ eq.last_maintenance|date:"d.m.Y" }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>
                    <div class="actions">
                        <a href="{% url 'equipment_detail' eq.barcode %}" 
                           class="btn-icon view" 
                           title="–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏">üëÅÔ∏è</a>
                        <a href="{% url 'equipment_update' eq.barcode %}" 
                           class="btn-icon edit" 
                           title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏">‚úèÔ∏è</a>
                        <form method="post" 
                              action="{% url 'equipment_delete' eq.barcode %}" 
                              style="display: inline; margin: 0;"
                              onsubmit="return confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è?');">
                            {% csrf_token %}
                            <button type="submit" 
                                    class="btn-icon delete" 
                                    title="–í–∏–¥–∞–ª–∏—Ç–∏">üóëÔ∏è</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="9">
                    <div class="empty-state">
                        <div class="empty-state-icon">üîß</div>
                        <h3>–û–±–ª–∞–¥–Ω–∞–Ω–Ω—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</h3>
                        <p>–î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à–µ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è –¥–æ —Å–∏—Å—Ç–µ–º–∏</p>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}