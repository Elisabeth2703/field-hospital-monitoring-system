{% extends 'base.html' %}

{% block title %}–ú–µ–¥–∏–∫–∞–º–µ–Ω—Ç–∏ - –ü–æ–ª—å–æ–≤–∏–π –ì–æ—Å–ø—ñ—Ç–∞–ª—å ‚Ññ7{% endblock %}

{% block extra_css %}
<style>
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 16px rgba(0,0,0,0.12);
    }

    .stat-info h3 {
        font-size: 14px;
        color: #8896a4;
        font-weight: 500;
        margin-bottom: 10px;
    }

    .stat-info .stat-value {
        font-size: 36px;
        font-weight: 700;
        color: #2c3e50;
    }

    .stat-icon {
        font-size: 48px;
    }

    .toolbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        gap: 20px;
    }

    .search-box {
        flex: 1;
        max-width: 500px;
        position: relative;
    }

    .search-box input {
        width: 100%;
        padding: 14px 20px 14px 50px;
        border: 2px solid #e8edf2;
        border-radius: 10px;
        font-size: 15px;
        transition: border-color 0.3s;
    }

    .search-box input:focus {
        outline: none;
        border-color: #4a90e2;
    }

    .search-box::before {
        content: 'üîç';
        position: absolute;
        left: 18px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 18px;
    }

    .btn {
        padding: 14px 28px;
        border: none;
        border-radius: 10px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s;
        text-decoration: none;
    }

    .btn-primary {
        background: #4a90e2;
        color: white;
    }

    .btn-primary:hover {
        background: #357abd;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
    }

    .filter-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }

    .filter-btn {
        padding: 10px 20px;
        border: 2px solid #e8edf2;
        background: white;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        color: #5a6c7d;
        transition: all 0.3s;
        text-decoration: none;
        display: inline-block;
    }

    .filter-btn.active {
        background: #4a90e2;
        color: white;
        border-color: #4a90e2;
    }

    .filter-btn:hover {
        border-color: #4a90e2;
    }

    .table-container {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        overflow-x: auto;
    }

    table {
        width: 100%;
        border-collapse: collapse;
    }

    thead {
        background: #f8fafb;
    }

    th {
        padding: 18px 20px;
        text-align: left;
        font-size: 13px;
        font-weight: 600;
        color: #8896a4;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    tbody tr {
        border-bottom: 1px solid #f1f3f5;
        transition: background 0.2s;
    }

    tbody tr:hover {
        background: #f8fafb;
    }

    td {
        padding: 20px;
        font-size: 15px;
        color: #2c3e50;
    }

    .badge {
        display: inline-block;
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 13px;
        font-weight: 600;
    }

    .badge.critical {
        background: #ffe5e5;
        color: #e74c3c;
    }

    .badge.warning {
        background: #fff3e0;
        color: #f39c12;
    }

    .badge.success {
        background: #e8f8f5;
        color: #27ae60;
    }

    .badge.info {
        background: #e3f2fd;
        color: #2196f3;
    }

    .actions {
        display: flex;
        gap: 10px;
    }

    .btn-icon {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        transition: all 0.2s;
        text-decoration: none;
    }

    .btn-icon.view {
        background: #e3f2fd;
        color: #2196f3;
    }

    .btn-icon.edit {
        background: #fff3e0;
        color: #f39c12;
    }

    .btn-icon.delete {
        background: #ffe5e5;
        color: #e74c3c;
    }

    .btn-icon:hover {
        transform: scale(1.1);
    }

    .progress-bar {
        width: 100%;
        height: 8px;
        background: #e8edf2;
        border-radius: 4px;
        overflow: hidden;
        margin-top: 8px;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #4a90e2, #357abd);
        transition: width 0.3s;
    }

    .progress-fill.low {
        background: linear-gradient(90deg, #e74c3c, #c0392b);
    }

    .progress-fill.medium {
        background: linear-gradient(90deg, #f39c12, #e67e22);
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #8896a4;
    }

    .empty-state-icon {
        font-size: 64px;
        margin-bottom: 20px;
    }
</style>
{% endblock %}

{% block content %}
<!-- Stats -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-info">
            <h3>–í—Å—å–æ–≥–æ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç—ñ–≤</h3>
            <div class="stat-value">{{ medications|length }}</div>
        </div>
        <div class="stat-icon">üíä</div>
    </div>

    <div class="stat-card">
        <div class="stat-info">
            <h3>–ö—Ä–∏—Ç–∏—á–Ω–∏–π —Å—Ç–∞–Ω</h3>
            <div class="stat-value" style="color: #e74c3c;">
                {{ medications|length }}
            </div>
        </div>
        <div class="stat-icon">‚ö†Ô∏è</div>
    </div>

    <div class="stat-card">
        <div class="stat-info">
            <h3>–î–æ—Å—Ç–∞—Ç–Ω—ñ–π –∑–∞–ø–∞—Å</h3>
            <div class="stat-value" style="color: #27ae60;">0</div>
        </div>
        <div class="stat-icon">‚úÖ</div>
    </div>

    <div class="stat-card">
        <div class="stat-info">
            <h3>–ü—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–æ</h3>
            <div class="stat-value" style="color: #f39c12;">0</div>
        </div>
        <div class="stat-icon">üìÖ</div>
    </div>
</div>

<!-- Toolbar -->
<div class="toolbar">
    <form method="get" class="search-box">
        <input type="text" 
               name="search" 
               placeholder="–ü–æ—à—É–∫ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç—É –∑–∞ –Ω–∞–∑–≤–æ—é –∞–±–æ —à—Ç—Ä–∏—Ö-–∫–æ–¥–æ–º..." 
               value="{{ search_query }}">
    </form>
    <a href="{% url 'medication_create' %}" class="btn btn-primary">
        ‚ûï –î–æ–¥–∞—Ç–∏ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç
    </a>
</div>

<!-- Filters -->
<div class="filter-buttons">
    <a href="{% url 'medication_list' %}" class="filter-btn {% if not request.GET.filter %}active{% endif %}">
        –í—Å—ñ
    </a>
    <a href="?filter=critical" class="filter-btn {% if request.GET.filter == 'critical' %}active{% endif %}">
        –ö—Ä–∏—Ç–∏—á–Ω—ñ
    </a>
    <a href="?filter=expired" class="filter-btn {% if request.GET.filter == 'expired' %}active{% endif %}">
        –ü—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω—ñ
    </a>
    <a href="?filter=sufficient" class="filter-btn {% if request.GET.filter == 'sufficient' %}active{% endif %}">
        –î–æ—Å—Ç–∞—Ç–Ω—ñ
    </a>
</div>

<!-- Table -->
<div class="table-container">
    <table>
        <thead>
            <tr>
                <th>–ù–∞–∑–≤–∞</th>
                <th>–®—Ç—Ä–∏—Ö-–∫–æ–¥</th>
                <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å</th>
                <th>–ö—Ä–∏—Ç–∏—á–Ω–∏–π —Ä—ñ–≤–µ–Ω—å</th>
                <th>–ó–∞–ø–∞—Å</th>
                <th>–¢–µ—Ä–º—ñ–Ω –ø—Ä–∏–¥–∞—Ç–Ω–æ—Å—Ç—ñ</th>
                <th>–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–î—ñ—ó</th>
            </tr>
        </thead>
        <tbody>
            {% for med in medications %}
            <tr>
                <td><strong>{{ med.name }}</strong></td>
                <td>{{ med.barcode }}</td>
                <td>{{ med.quantity }} {{ med.unit }}</td>
                <td>{{ med.critical_level }}</td>
                <td>
                    {% widthratio med.quantity med.critical_level 100 as percentage %}
                    <div>{{ percentage }}%</div>
                    <div class="progress-bar">
                        <div class="progress-fill {% if percentage < 70 %}low{% elif percentage < 100 %}medium{% endif %}" 
                             style="width: {% if percentage > 100 %}100{% else %}{{ percentage }}{% endif %}%"></div>
                    </div>
                </td>
                <td>
                    {% if med.expiry_date %}
                        {{ med.expiry_date|date:"d.m.Y" }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>{{ med.supplier|default:"-" }}</td>
                <td>
                    {% if med.quantity <= med.critical_level %}
                        <span class="badge critical">–ö—Ä–∏—Ç–∏—á–Ω–∏–π</span>
                    {% elif med.quantity < med.critical_level|add:50 %}
                        <span class="badge warning">–£–≤–∞–≥–∞</span>
                    {% else %}
                        <span class="badge success">–î–æ—Å—Ç–∞—Ç–Ω—å–æ</span>
                    {% endif %}
                </td>
                <td>
                    <div class="actions">
                        <a href="{% url 'medication_detail' med.barcode %}" 
                           class="btn-icon view" 
                           title="–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏">üëÅÔ∏è</a>
                        <a href="{% url 'medication_update' med.barcode %}" 
                           class="btn-icon edit" 
                           title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏">‚úèÔ∏è</a>
                        <form method="post" 
                              action="{% url 'medication_delete' med.barcode %}" 
                              style="display: inline;"
                              onsubmit="return confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ–π –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç?');">
                            {% csrf_token %}
                            <button type="submit" 
                                    class="btn-icon delete" 
                                    title="–í–∏–¥–∞–ª–∏—Ç–∏">üóëÔ∏è</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="9">
                    <div class="empty-state">
                        <div class="empty-state-icon">üíä</div>
                        <h3>–ú–µ–¥–∏–∫–∞–º–µ–Ω—Ç—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</h3>
                        <p>–î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à–∏–π –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç –¥–æ —Å–∏—Å—Ç–µ–º–∏</p>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}