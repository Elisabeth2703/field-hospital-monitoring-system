{% extends 'base.html' %}

{% block title %}
    {% if medication %}–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç—É{% else %}–î–æ–¥–∞–≤–∞–Ω–Ω—è –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç—É{% endif %} - –ü–æ–ª—å–æ–≤–∏–π –ì–æ—Å–ø—ñ—Ç–∞–ª—å ‚Ññ7
{% endblock %}

{% block extra_css %}
<style>
    .form-container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        padding: 40px;
    }

    .form-header {
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid #e8edf2;
    }

    .form-header h1 {
        font-size: 28px;
        color: #2c3e50;
        margin-bottom: 10px;
    }

    .form-header p {
        color: #8896a4;
        font-size: 15px;
    }

    .form-group {
        margin-bottom: 25px;
    }

    .form-label {
        display: block;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 8px;
        font-size: 14px;
    }

    .form-label.required::after {
        content: ' *';
        color: #e74c3c;
    }

    .form-input {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e8edf2;
        border-radius: 8px;
        font-size: 15px;
        transition: border-color 0.3s;
        font-family: inherit;
    }

    .form-input:focus {
        outline: none;
        border-color: #4a90e2;
    }

    .form-input.error {
        border-color: #e74c3c;
    }

    .form-help {
        font-size: 13px;
        color: #8896a4;
        margin-top: 5px;
    }

    .form-error {
        font-size: 13px;
        color: #e74c3c;
        margin-top: 5px;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .form-row {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
    }

    .form-actions {
        display: flex;
        gap: 15px;
        margin-top: 30px;
        padding-top: 30px;
        border-top: 2px solid #e8edf2;
    }

    .btn {
        padding: 14px 28px;
        border: none;
        border-radius: 10px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s;
        text-decoration: none;
    }

    .btn-primary {
        background: #4a90e2;
        color: white;
        flex: 1;
    }

    .btn-primary:hover {
        background: #357abd;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
    }

    .btn-secondary {
        background: white;
        color: #5a6c7d;
        border: 2px solid #e8edf2;
    }

    .btn-secondary:hover {
        border-color: #4a90e2;
        color: #4a90e2;
    }

    .icon-input-group {
        position: relative;
    }

    .icon-input-group .form-input {
        padding-left: 45px;
    }

    .input-icon {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 20px;
    }

    @media (max-width: 768px) {
        .form-container {
            padding: 20px;
        }

        .form-row {
            grid-template-columns: 1fr;
        }

        .form-actions {
            flex-direction: column;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="form-container">
    <div class="form-header">
        <h1>
            {% if medication %}
                ‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç—É
            {% else %}
                ‚ûï –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç—É
            {% endif %}
        </h1>
        <p>–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó</p>
    </div>

    <form method="post" id="medicationForm">
        {% csrf_token %}

        <!-- –ù–∞–∑–≤–∞ -->
        <div class="form-group">
            <label class="form-label required" for="name">–ù–∞–∑–≤–∞ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç—É</label>
            <div class="icon-input-group">
                <span class="input-icon">üíä</span>
                <input type="text" 
                       class="form-input" 
                       id="name" 
                       name="name" 
                       value="{{ medication.name|default:'' }}"
                       required
                       placeholder="–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç—É">
            </div>
            <div class="form-help">–ü–æ–≤–Ω–∞ –Ω–∞–∑–≤–∞ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç—É</div>
        </div>

        <!-- –®—Ç—Ä–∏—Ö-–∫–æ–¥ -->
        <div class="form-group">
            <label class="form-label required" for="barcode">–®—Ç—Ä–∏—Ö-–∫–æ–¥</label>
            <div class="icon-input-group">
                <span class="input-icon">üìä</span>
                <input type="text" 
                       class="form-input" 
                       id="barcode" 
                       name="barcode" 
                       value="{{ medication.barcode|default:'' }}"
                       required
                       {% if medication %}readonly{% endif %}
                       placeholder="–í–≤–µ–¥—ñ—Ç—å —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —à—Ç—Ä–∏—Ö-–∫–æ–¥">
            </div>
            <div class="form-help">
                {% if medication %}
                    –®—Ç—Ä–∏—Ö-–∫–æ–¥ –Ω–µ –º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏ –ø—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è
                {% else %}
                    –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç—É
                {% endif %}
            </div>
        </div>

        <!-- –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–∞ –û–¥–∏–Ω–∏—Ü—è –≤–∏–º—ñ—Ä—É -->
        <div class="form-row">
            <div class="form-group">
                <label class="form-label required" for="quantity">–ö—ñ–ª—å–∫—ñ—Å—Ç—å</label>
                <div class="icon-input-group">
                    <span class="input-icon">üì¶</span>
                    <input type="number" 
                           class="form-input" 
                           id="quantity" 
                           name="quantity" 
                           value="{{ medication.quantity|default:'' }}"
                           required
                           min="0"
                           placeholder="0">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label required" for="unit">–û–¥–∏–Ω–∏—Ü—è –≤–∏–º—ñ—Ä—É</label>
                <select class="form-input" id="unit" name="unit" required>
                    <option value="">–û–±–µ—Ä—ñ—Ç—å –æ–¥–∏–Ω–∏—Ü—é</option>
                    <option value="—Ç–∞–±–ª–µ—Ç–∫–∏" {% if medication.unit == '—Ç–∞–±–ª–µ—Ç–∫–∏' %}selected{% endif %}>–¢–∞–±–ª–µ—Ç–∫–∏</option>
                    <option value="–∫–∞–ø—Å—É–ª–∏" {% if medication.unit == '–∫–∞–ø—Å—É–ª–∏' %}selected{% endif %}>–ö–∞–ø—Å—É–ª–∏</option>
                    <option value="–∞–º–ø—É–ª–∏" {% if medication.unit == '–∞–º–ø—É–ª–∏' %}selected{% endif %}>–ê–º–ø—É–ª–∏</option>
                    <option value="—Ñ–ª–∞–∫–æ–Ω–∏" {% if medication.unit == '—Ñ–ª–∞–∫–æ–Ω–∏' %}selected{% endif %}>–§–ª–∞–∫–æ–Ω–∏</option>
                    <option value="–º–ª" {% if medication.unit == '–º–ª' %}selected{% endif %}>–ú—ñ–ª—ñ–ª—ñ—Ç—Ä–∏ (–º–ª)</option>
                    <option value="–≥" {% if medication.unit == '–≥' %}selected{% endif %}>–ì—Ä–∞–º–∏ (–≥)</option>
                    <option value="—à—Ç" {% if medication.unit == '—à—Ç' %}selected{% endif %}>–®—Ç—É–∫–∏</option>
                </select>
            </div>
        </div>

        <!-- –ö—Ä–∏—Ç–∏—á–Ω–∏–π —Ä—ñ–≤–µ–Ω—å -->
        <div class="form-group">
            <label class="form-label required" for="critical_level">–ö—Ä–∏—Ç–∏—á–Ω–∏–π —Ä—ñ–≤–µ–Ω—å</label>
            <div class="icon-input-group">
                <span class="input-icon">‚ö†Ô∏è</span>
                <input type="number" 
                       class="form-input" 
                       id="critical_level" 
                       name="critical_level" 
                       value="{{ medication.critical_level|default:'' }}"
                       required
                       min="0"
                       placeholder="–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π –∑–∞–ø–∞—Å">
            </div>
            <div class="form-help">–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å, –Ω–∏–∂—á–µ —è–∫–æ—ó –ø–æ—Ç—Ä—ñ–±–Ω–µ –ø–æ–ø–æ–≤–Ω–µ–Ω–Ω—è</div>
        </div>

        <!-- –¢–µ—Ä–º—ñ–Ω –ø—Ä–∏–¥–∞—Ç–Ω–æ—Å—Ç—ñ -->
        <div class="form-group">
            <label class="form-label" for="expiry_date">–¢–µ—Ä–º—ñ–Ω –ø—Ä–∏–¥–∞—Ç–Ω–æ—Å—Ç—ñ</label>
            <div class="icon-input-group">
                <span class="input-icon">üìÖ</span>
                <input type="date" 
                       class="form-input" 
                       id="expiry_date" 
                       name="expiry_date" 
                       value="{{ medication.expiry_date|default:'' }}">
            </div>
            <div class="form-help">–î–∞—Ç–∞, –¥–æ —è–∫–æ—ó –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç –ø—Ä–∏–¥–∞—Ç–Ω–∏–π –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è</div>
        </div>

        <!-- –ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫ -->
        <div class="form-group">
            <label class="form-label" for="supplier">–ü–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫</label>
            <div class="icon-input-group">
                <span class="input-icon">üè¢</span>
                <input type="text" 
                       class="form-input" 
                       id="supplier" 
                       name="supplier" 
                       value="{{ medication.supplier|default:'' }}"
                       placeholder="–ù–∞–∑–≤–∞ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫–∞">
            </div>
            <div class="form-help">–ö–æ–º–ø–∞–Ω—ñ—è –∞–±–æ –æ—Ä–≥–∞–Ω—ñ–∑–∞—Ü—ñ—è –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫</div>
        </div>

        <!-- Actions -->
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                {% if medication %}
                    üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏
                {% else %}
                    ‚ûï –î–æ–¥–∞—Ç–∏ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç
                {% endif %}
            </button>
            <a href="{% url 'medication_list' %}" class="btn btn-secondary">
                ‚ùå –°–∫–∞—Å—É–≤–∞—Ç–∏
            </a>
        </div>
    </form>
</div>

<script>
    // Form validation
    document.getElementById('medicationForm').addEventListener('submit', function(e) {
        const quantity = parseInt(document.getElementById('quantity').value);
        const criticalLevel = parseInt(document.getElementById('critical_level').value);
        
        if (quantity < 0) {
            e.preventDefault();
            alert('–ö—ñ–ª—å–∫—ñ—Å—Ç—å –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –≤—ñ–¥\'—î–º–Ω–æ—é');
            return false;
        }
        
        if (criticalLevel < 0) {
            e.preventDefault();
            alert('–ö—Ä–∏—Ç–∏—á–Ω–∏–π —Ä—ñ–≤–µ–Ω—å –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ –≤—ñ–¥\'—î–º–Ω–∏–º');
            return false;
        }
    });

    // Auto-generate barcode if empty
    {% if not medication %}
    document.getElementById('name').addEventListener('blur', function() {
        const barcodeInput = document.getElementById('barcode');
        if (!barcodeInput.value) {
            const randomCode = 'MED' + Date.now().toString().slice(-6);
            barcodeInput.value = randomCode;
        }
    });
    {% endif %}
</script>
{% endblock %}