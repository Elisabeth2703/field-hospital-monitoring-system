{% extends 'patients/base.html' %}

{% block title %}{{ patient.full_name }}{% endblock %}

{% block content %}
<div style="margin-bottom: 20px;">
  <a href="{% url 'patient_list' %}" style="color: #3498db; text-decoration: none;">
    ‚Üê –ù–∞–∑–∞–¥ –¥–æ —Å–ø–∏—Å–∫—É
  </a>
</div>

<h2 style="color: #2c3e50; margin-bottom: 20px;">{{ patient.full_name }}</h2>

<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 30px;">
  <div style="background: #ecf0f1; padding: 15px; border-radius: 8px;">
    <strong>ID –ë—Ä–∞—Å–ª–µ—Ç—É:</strong><br>
    <code style="background: white; padding: 4px 8px; border-radius: 4px;">{{ patient.bracelet_id }}</code>
  </div>
    
  <div style="background: #ecf0f1; padding: 15px; border-radius: 8px;">
    <strong>–í—ñ–∫:</strong> {{ patient.age }} —Ä–æ–∫—ñ–≤
  </div>
  
  <div style="background: #ecf0f1; padding: 15px; border-radius: 8px;">
    <strong>–ì—Ä—É–ø–∞ –∫—Ä–æ–≤—ñ:</strong> {{ patient.blood_type|default:"–ù–µ –≤–∫–∞–∑–∞–Ω–æ" }}
  </div>
  
  <div style="background: #ecf0f1; padding: 15px; border-radius: 8px;">
    <strong>–õ—ñ–∂–∫–æ:</strong> {{ patient.bed_number|default:"–ù–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–æ" }}
  </div>
  
  <div style="background: #ecf0f1; padding: 15px; border-radius: 8px;">
    <strong>–¢–∏–ø –ø–æ—Ä–∞–Ω–µ–Ω–Ω—è:</strong> {{ patient.injury_type }}
  </div>
    
  <div style="background: #ecf0f1; padding: 15px; border-radius: 8px;">
    <strong>–í–∞–∂–∫—ñ—Å—Ç—å:</strong> 
    <span style="
      background:
        {% if patient.severity == '–ö—Ä–∏—Ç–∏—á–Ω–∏–π' %}#e74c3c
        {% elif patient.severity == '–í–∞–∂–∫–∏–π' %}#f39c12
        {% elif patient.severity == '–°–µ—Ä–µ–¥–Ω—ñ–π' %}#3498db
        {% else %}#27ae60
        {% endif %};
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 14px;
    ">
  {{ patient.severity }}
</span>
  </div>
  
  <div style="background: #ecf0f1; padding: 15px; border-radius: 8px;">
    <strong>–î–∞—Ç–∞ –ø—Ä–∏–π–æ–º—É:</strong> {{ patient.admission_date|date:"d.m.Y H:i" }}
  </div>
  
  <div style="background: #ecf0f1; padding: 15px; border-radius: 8px;">
    <strong>–°—Ç–∞—Ç—É—Å:</strong> {{ patient.status }}
  </div>
</div>

{% if patient.notes %}
<div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-bottom: 30px;">
  <strong>–ü—Ä–∏–º—ñ—Ç–∫–∏:</strong><br>
  {{ patient.notes }}
</div>
{% endif %}

<h3 style="margin-top: 30px; margin-bottom: 15px;">–ñ–∏—Ç—Ç—î–≤—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏</h3>

{% if avg_heart_rate %}
<div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
  <div style="background: #ffe5e5; padding: 15px; border-radius: 8px; text-align: center;">
    <div style="font-size: 12px; color: #666;">–°–µ—Ä–µ–¥–Ω—ñ–π –ø—É–ª—å—Å</div>
    <div style="font-size: 28px; font-weight: bold; color: #e74c3c;">{{ avg_heart_rate|floatformat:0 }}</div>
    <div style="font-size: 12px; color: #666;">—É–¥/—Ö–≤</div>
  </div>
  
  <div style="background: #e5f3ff; padding: 15px; border-radius: 8px; text-align: center;">
    <div style="font-size: 12px; color: #666;">–°–µ—Ä–µ–¥–Ω—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</div>
    <div style="font-size: 28px; font-weight: bold; color: #3498db;">{{ avg_temperature|floatformat:1 }}</div>
    <div style="font-size: 12px; color: #666;">¬∞C</div>
  </div>
  
  <div style="background: #e5ffe5; padding: 15px; border-radius: 8px; text-align: center;">
    <div style="font-size: 12px; color: #666;">–°–µ—Ä–µ–¥–Ω—ñ–π O‚ÇÇ</div>
    <div style="font-size: 28px; font-weight: bold; color: #27ae60;">{{ avg_oxygen|floatformat:0 }}</div>
    <div style="font-size: 12px; color: #666;">%</div>
  </div>
</div>
{% endif %}

<details style="margin-bottom: 20px;">
  <summary style="cursor: pointer; padding: 10px; background: #3498db; color: white; border-radius: 4px;">
    –î–æ–¥–∞—Ç–∏ –Ω–æ–≤—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏
  </summary>
  <form method="post" action="{% url 'add_vital_signs' patient.bracelet_id %}" 
    style="margin-top: 10px; padding: 15px; background: #f8f9fa; border-radius: 4px;">
      {% csrf_token %}
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
        <div>
          <label>–ü—É–ª—å—Å (—É–¥/—Ö–≤):</label>
            <input type="number" name="heart_rate" required min="30" max="200" value="75"
              style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        <div>
          <label>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (¬∞C):</label>
            <input type="number" name="temperature" required min="35" max="42" step="0.1" value="36.6"
              style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        <div>
          <label>–¢–∏—Å–∫ —Å–∏—Å—Ç–æ–ª.:</label>
            <input type="number" name="blood_pressure_sys" required min="70" max="200" value="120"
              style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        <div>
          <label>–¢–∏—Å–∫ –¥—ñ–∞—Å—Ç–æ–ª.:</label>
            <input type="number" name="blood_pressure_dia" required min="40" max="130" value="80"
              style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
        <div>
          <label>–°–∞—Ç—É—Ä–∞—Ü—ñ—è O‚ÇÇ (%):</label>
            <input type="number" name="oxygen_saturation" required min="70" max="100" value="98"
              style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
        </div>
      </div>
      <button type="submit" style="margin-top: 10px; padding: 8px 20px; background: #27ae60; 
        color: white; border: none; border-radius: 4px; cursor: pointer;">
        –î–æ–¥–∞—Ç–∏ –ø–æ–∫–∞–∑–Ω–∏–∫–∏
      </button>
  </form>
</details>

<table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
  <thead>
    <tr style="background: #34495e; color: white;">
      <th style="padding: 10px;">–ß–∞—Å</th>
      <th style="padding: 10px;">–ü—É–ª—å—Å</th>
      <th style="padding: 10px;">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</th>
      <th style="padding: 10px;">–¢–∏—Å–∫</th>
      <th style="padding: 10px;">O‚ÇÇ</th>
    </tr>
  </thead>
  <tbody>
    {% for vital in vital_signs %}
    <tr style="border-bottom: 1px solid #ddd;">
      <td style="padding: 10px;">{{ vital.timestamp|date:"d.m.Y H:i" }}</td>
      <td style="padding: 10px;">{{ vital.heart_rate }} —É–¥/—Ö–≤</td>
      <td style="padding: 10px;">{{ vital.temperature }} ¬∞C</td>
        <td style="padding: 10px;">{{ vital.temperature }} ¬∞C</td>
      <td style="padding: 10px;">{{ vital.blood_pressure_sys }}/{{ vital.blood_pressure_dia }}</td>
      <td style="padding: 10px;">{{ vital.oxygen_saturation }}%</td>
    </tr>
      {% empty %}
    <tr>
      <td colspan="5" style="padding: 20px; text-align: center; color: #95a5a6;">
        –ü–æ–∫–∞–∑–Ω–∏–∫–∏ –≤—ñ–¥—Å—É—Ç–Ω—ñ. –î–æ–¥–∞–π—Ç–µ –ø–µ—Ä—à—ñ –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è.
      </td>
    </tr>
      {% endfor %}
  </tbody>
</table>

{% if classifications %}
<h3 style="margin-top: 30px; margin-bottom: 15px;">–ö–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –ø–æ—Ä–∞–Ω–µ–Ω—å</h3>
<div style="display: flex; flex-direction: column; gap: 15px;">
  {% for classification in classifications %}
  <div style="background: #f8f9fa; padding: 15px; border-left: 4px solid #3498db; border-radius: 4px;">
    <div style="display: flex; justify-content: between; margin-bottom: 10px;">
      <strong>{{ classification.injury_type }}</strong>
      <span style="color: #666; font-size: 14px;">{{ classification.classification_date|date:"d.m.Y H:i" }}</span>
    </div>
    <div style="margin-bottom: 5px;">
      <strong>–í–∞–∂–∫—ñ—Å—Ç—å:</strong> {{ classification.severity }}
    </div>
    <div style="margin-bottom: 5px;">
      <strong>–î—ñ–∞–≥–Ω–æ–∑:</strong> {{ classification.diagnosis }}
    </div>
      {% if classification.treatment_plan %}
    <div>
      <strong>–ü–ª–∞–Ω –ª—ñ–∫—É–≤–∞–Ω–Ω—è:</strong> {{ classification.treatment_plan }}
    </div>
    {% endif %}
  </div>
  {% endfor %}
</div>
{% endif %}

<div style="margin-top: 30px; text-align: center;">
  <a href="{% url 'patient_time_series' patient.bracelet_id %}" 
    style="display: inline-block; padding: 15px 30px; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white; text-decoration: none; border-radius: 8px; font-weight: bold;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); transition: all 0.3s;">
    üìà –ê–Ω–∞–ª—ñ–∑ —á–∞—Å–æ–≤–∏—Ö —Ä—è–¥—ñ–≤
  </a>
</div>
{% endblock %}