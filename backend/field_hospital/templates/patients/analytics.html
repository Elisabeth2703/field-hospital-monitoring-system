{% extends 'patients/base.html' %} 
{% block title %}
–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ —Ç–∞ –ø—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è
{% endblock %} 

{% block content %}
<h2 style="color: #2c3e50; margin-bottom: 20px">
  üìä –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ —Ç–∞ –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è –≤–∏–ø–∞–¥–∫—ñ–≤
</h2>

<div style="margin-bottom: 30px; display: flex; gap: 10px">
  <a
    href="?period=week"
    style="padding: 12px 24px; background: {% if period == 'week' %}linear-gradient(135deg, #667eea 0%, #764ba2 100%){% else %}#ecf0f1{% endif %}; 
      color: {% if period == 'week' %}white{% else %}#2c3e50{% endif %}; 
      text-decoration: none; border-radius: 8px; font-weight: bold; transition: all 0.3s;"
  >
    üìÖ –¢–∏–∂–¥–µ–Ω—å
  </a>
  <a
    href="?period=three_months"
    style="padding: 12px 24px; background: {% if period == 'three_months' %}linear-gradient(135deg, #667eea 0%, #764ba2 100%){% else %}#ecf0f1{% endif %}; 
      color: {% if period == 'three_months' %}white{% else %}#2c3e50{% endif %}; 
      text-decoration: none; border-radius: 8px; font-weight: bold; transition: all 0.3s;"
  >
    üìÖ 3 –º—ñ—Å—è—Ü—ñ
  </a>
  <a
    href="?period=year"
    style="padding: 12px 24px; background: {% if period == 'year' %}linear-gradient(135deg, #667eea 0%, #764ba2 100%){% else %}#ecf0f1{% endif %}; 
      color: {% if period == 'year' %}white{% else %}#2c3e50{% endif %}; 
      text-decoration: none; border-radius: 8px; font-weight: bold; transition: all 0.3s;"
  >
    üìÖ –†—ñ–∫
  </a>
</div>

<div
  style="
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 40px;
    border-radius: 12px;
    margin-bottom: 30px;
    text-align: center;
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
  "
>
  <h3 style="margin-bottom: 15px; font-size: 18px; opacity: 0.9">
    –ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–∞—Ü—ñ—î–Ω—Ç—ñ–≤ –∑–∞ –ø–µ—Ä—ñ–æ–¥
  </h3>
  <div
    style="
      font-size: 64px;
      font-weight: bold;
      text-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    "
  >
    {{ period_analysis.total_patients }}
  </div>
  <p style="margin-top: 10px; opacity: 0.9">
    –ü–µ—Ä—ñ–æ–¥: {{ period_analysis.days }} –¥–Ω—ñ–≤
  </p>
</div>

{% if period_analysis.age_statistics %}
<div
  style="
    background: white;
    padding: 30px;
    border-radius: 12px;
    margin-bottom: 30px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  "
>
  <h3 style="margin-bottom: 20px; color: #2c3e50">
    üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ñ–∫—É –ø–∞—Ü—ñ—î–Ω—Ç—ñ–≤ (NumPy –∞–Ω–∞–ª—ñ–∑)
  </h3>
  <div
    style="
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 20px;
    "
  >
    <div
      style="
        text-align: center;
        padding: 20px;
        background: #e3f2fd;
        border-radius: 8px;
      "
    >
      <div style="font-size: 12px; color: #666; margin-bottom: 5px">
        –°–µ—Ä–µ–¥–Ω—ñ–π –≤—ñ–∫
      </div>
      <div style="font-size: 32px; font-weight: bold; color: #1976d2">
        {{ period_analysis.age_statistics.mean|floatformat:1 }}
      </div>
    </div>
    <div
      style="
        text-align: center;
        padding: 20px;
        background: #f3e5f5;
        border-radius: 8px;
      "
    >
      <div style="font-size: 12px; color: #666; margin-bottom: 5px">
        –ú–µ–¥—ñ–∞–Ω–∞
      </div>
      <div style="font-size: 32px; font-weight: bold; color: #7b1fa2">
        {{ period_analysis.age_statistics.median|floatformat:0 }}
      </div>
    </div>
    <div
      style="
        text-align: center;
        padding: 20px;
        background: #e8f5e9;
        border-radius: 8px;
      "
    >
      <div style="font-size: 12px; color: #666; margin-bottom: 5px">
        –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–π
      </div>
      <div style="font-size: 32px; font-weight: bold; color: #388e3c">
        {{ period_analysis.age_statistics.min }}
      </div>
    </div>
    <div
      style="
        text-align: center;
        padding: 20px;
        background: #fff3e0;
        border-radius: 8px;
      "
    >
      <div style="font-size: 12px; color: #666; margin-bottom: 5px">
        –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∏–π
      </div>
      <div style="font-size: 32px; font-weight: bold; color: #f57c00">
        {{ period_analysis.age_statistics.max }}
      </div>
    </div>
    <div
      style="
        text-align: center;
        padding: 20px;
        background: #fce4ec;
        border-radius: 8px;
      "
    >
      <div style="font-size: 12px; color: #666; margin-bottom: 5px">
        –°—Ç. –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è
      </div>
      <div style="font-size: 32px; font-weight: bold; color: #c2185b">
        {{ period_analysis.age_statistics.std|floatformat:2 }}
      </div>
    </div>
  </div>
</div>
{% endif %} {% if injury_classification %}
<div
  style="
    background: white;
    padding: 30px;
    border-radius: 12px;
    margin-bottom: 30px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  "
>
  <h3 style="margin-bottom: 20px; color: #2c3e50">
    ü§ñ ML –ö–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—è –ø–æ—Ä–∞–Ω–µ–Ω—å –∑–∞ –≤–∞–∂–∫—ñ—Å—Ç—é
  </h3>
  <p style="color: #7f8c8d; margin-bottom: 20px; font-size: 14px">
    –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ: Pandas –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –¥–∞–Ω–∏—Ö, Scikit-learn –¥–ª—è –∫–ª–∞—Å–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
  </p>
  <div
    style="
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    "
  >
    {% for injury_type, stats in injury_classification.items %}
    <div
      style="border-left: 4px solid 
      {% if stats.average_severity >= 3.5 %}#e74c3c
      {% elif stats.average_severity >= 2.5 %}#f39c12
      {% elif stats.average_severity >= 1.5 %}#3498db
      {% else %}#27ae60{% endif %};
      padding: 20px; background: #f8f9fa; border-radius: 8px;"
    >
      <div style="font-weight: bold; color: #2c3e50; margin-bottom: 10px">
        {{ injury_type }}
      </div>
      <div style="font-size: 12px; color: #7f8c8d; margin-bottom: 15px">
        –ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏–ø–∞–¥–∫—ñ–≤: {{ stats.count }}
      </div>
      <div
        style="
          display: flex;
          justify-content: space-between;
          margin-bottom: 10px;
        "
      >
        <span style="font-size: 12px; color: #666">–°–µ—Ä–µ–¥–Ω—è –≤–∞–∂–∫—ñ—Å—Ç—å:</span>
        <span
          style="font-weight: bold; color: 
          {% if stats.average_severity >= 3.5 %}#e74c3c
          {% elif stats.average_severity >= 2.5 %}#f39c12
          {% else %}#3498db{% endif %};"
        >
          {{ stats.average_severity|floatformat:2 }} / 4.0
        </span>
      </div>
      <div
        style="
          background: #ecf0f1;
          height: 8px;
          border-radius: 4px;
          overflow: hidden;
        "
      >
        <div
          style="background: 
          {% if stats.average_severity >= 3.5 %}linear-gradient(90deg, #e74c3c, #c0392b)
          {% elif stats.average_severity >= 2.5 %}linear-gradient(90deg, #f39c12, #e67e22)
          {% else %}linear-gradient(90deg, #3498db, #2980b9){% endif %};
          height: 100%; width: {{ stats.average_severity|floatformat:0|add:'0' }}%; transition: width 0.5s;"
        ></div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endif %} {% if flow_prediction %}
<div
  style="
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    color: white;
    padding: 30px;
    border-radius: 12px;
    margin-bottom: 30px;
    box-shadow: 0 10px 30px rgba(240, 147, 251, 0.3);
  "
>
  <h3 style="margin-bottom: 20px">
    üîÆ –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞–¥—Ö–æ–¥–∂–µ–Ω—å –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω—ñ 7 –¥–Ω—ñ–≤ (ML)
  </h3>
  <p style="opacity: 0.9; margin-bottom: 20px; font-size: 14px">
    –ú–æ–¥–µ–ª—å: Linear Regression (Scikit-learn)
  </p>
  <div
    style="
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    "
  >
    <div
      style="
        background: rgba(255, 255, 255, 0.2);
        padding: 20px;
        border-radius: 8px;
        backdrop-filter: blur(10px);
      "
    >
      <div style="font-size: 14px; opacity: 0.9; margin-bottom: 5px">
        –ü—Ä–æ–≥–Ω–æ–∑ (—Å–µ—Ä–µ–¥–Ω—î/–¥–µ–Ω—å)
      </div>
      <div style="font-size: 36px; font-weight: bold">
        {{ flow_prediction.predicted_daily_average|floatformat:1 }}
      </div>
    </div>
    <div
      style="
        background: rgba(255, 255, 255, 0.2);
        padding: 20px;
        border-radius: 8px;
        backdrop-filter: blur(10px);
      "
    >
      <div style="font-size: 14px; opacity: 0.9; margin-bottom: 5px">
        –ó–∞–≥–∞–ª–æ–º –∑–∞ 7 –¥–Ω—ñ–≤
      </div>
      <div style="font-size: 36px; font-weight: bold">
        {{ flow_prediction.predicted_total|floatformat:0 }}
      </div>
    </div>
    <div
      style="
        background: rgba(255, 255, 255, 0.2);
        padding: 20px;
        border-radius: 8px;
        backdrop-filter: blur(10px);
      "
    >
      <div style="font-size: 14px; opacity: 0.9; margin-bottom: 5px">–¢—Ä–µ–Ω–¥</div>
      <div style="font-size: 24px; font-weight: bold">
        {% if flow_prediction.trend == 'increasing' %} üìà –ó—Ä–æ—Å—Ç–∞–Ω–Ω—è {% else %}
        üìâ –°–ø–∞–¥–∞–Ω–Ω—è {% endif %}
      </div>
    </div>
    <div
      style="
        background: rgba(255, 255, 255, 0.2);
        padding: 20px;
        border-radius: 8px;
        backdrop-filter: blur(10px);
      "
    >
      <div style="font-size: 14px; opacity: 0.9; margin-bottom: 5px">
        –¢–æ—á–Ω—ñ—Å—Ç—å –º–æ–¥–µ–ª—ñ
      </div>
      <div style="font-size: 36px; font-weight: bold">
        {{ flow_prediction.confidence|floatformat:2 }}
      </div>
    </div>
  </div>
</div>
{% endif %} {% if correlation %}
<div
  style="
    background: white;
    padding: 30px;
    border-radius: 12px;
    margin-bottom: 30px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  "
>
  <h3 style="margin-bottom: 20px; color: #2c3e50">
    üîó –ö–æ—Ä–µ–ª—è—Ü—ñ–π–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ (Pandas)
  </h3>
  <div
    style="
      background: #e8f5e9;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    "
  >
    <div style="font-size: 14px; color: #2e7d32; margin-bottom: 10px">
      –ö–æ—Ä–µ–ª—è—Ü—ñ—è –º—ñ–∂ –≤—ñ–∫–æ–º —Ç–∞ –≤–∞–∂–∫—ñ—Å—Ç—é —Å—Ç–∞–Ω—É:
    </div>
    <div style="font-size: 48px; font-weight: bold; color: #1b5e20">
      {{ correlation.correlation_age_severity|floatformat:3 }}
    </div>
    <div style="font-size: 12px; color: #666; margin-top: 10px">
      {% if correlation.correlation_age_severity > 0.5 %} –°–∏–ª—å–Ω–∞ –ø–æ–∑–∏—Ç–∏–≤–Ω–∞
      –∫–æ—Ä–µ–ª—è—Ü—ñ—è - —Å—Ç–∞—Ä—à—ñ –ø–∞—Ü—ñ—î–Ω—Ç–∏ –º–∞—é—Ç—å –≤–∞–∂—á—ñ –≤–∏–ø–∞–¥–∫–∏ {% elif
      correlation.correlation_age_severity > 0 %} –°–ª–∞–±–∫–∞ –ø–æ–∑–∏—Ç–∏–≤–Ω–∞ –∫–æ—Ä–µ–ª—è—Ü—ñ—è {%
      elif correlation.correlation_age_severity < -0.5 %} –°–∏–ª—å–Ω–∞ –Ω–µ–≥–∞—Ç–∏–≤–Ω–∞
      –∫–æ—Ä–µ–ª—è—Ü—ñ—è {% else %} –ö–æ—Ä–µ–ª—è—Ü—ñ—è –≤—ñ–¥—Å—É—Ç–Ω—è –∞–±–æ –¥—É–∂–µ —Å–ª–∞–±–∫–∞ {% endif %}
    </div>
  </div>

  <h4 style="margin-bottom: 15px; color: #2c3e50"></h4>
  <div
    style="
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
    "
  >
    {% for age_group, severity in correlation.age_group_severity.items %}
    <div
      style="text-align: center; padding: 20px; background: #f8f9fa; border-radius: 8px; border-top: 4px solid 
      {% if severity >= 3 %}#e74c3c{% elif severity >= 2 %}#f39c12{% else %}#3498db{% endif %};"
    >
      <div style="font-size: 12px; color: #666; margin-bottom: 5px">
        {{ age_group }} —Ä–æ–∫—ñ–≤
      </div>
      <div
        style="font-size: 28px; font-weight: bold; color: 
      {% if severity >= 3 %}#e74c3c{% elif severity >= 2 %}#f39c12{% else %}#3498db{% endif %};"
      >
        {{ severity|floatformat:2 }}
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endif %}

<div
  style="
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 30px;
    margin-bottom: 30px;
  "
>
  <div
    style="
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    "
  >
    <h3 style="margin-bottom: 20px; color: #2c3e50">
      üìä –†–æ–∑–ø–æ–¥—ñ–ª –∑–∞ —Ç–∏–ø–∞–º–∏ –ø–æ—Ä–∞–Ω–µ–Ω—å
    </h3>
    {% for injury_type, count in period_analysis.by_injury.items %}
    <div style="margin-bottom: 15px">
      <div
        style="
          display: flex;
          justify-content: space-between;
          margin-bottom: 5px;
        "
      >
        <span style="font-size: 14px; color: #2c3e50">{{ injury_type }}</span>
        <span style="font-weight: bold; color: #667eea">{{ count }}</span>
      </div>
      <div
        style="
          background: #ecf0f1;
          height: 10px;
          border-radius: 5px;
          overflow: hidden;
        "
      >
        <div
          style="background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; 
          width: {% widthratio count period_analysis.total_patients 100 %}%; 
          transition: width 0.5s;"
        ></div>
      </div>
    </div>
    {% endfor %}
  </div>

  <div
    style="
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    "
  >
    <h3 style="margin-bottom: 20px; color: #2c3e50">‚ö†Ô∏è –†–æ–∑–ø–æ–¥—ñ–ª –∑–∞ –≤–∞–∂–∫—ñ—Å—Ç—é</h3>
    <div style="display: grid; gap: 15px">
      {% for severity, count in period_analysis.by_severity.items %}
      <div
        style="padding: 20px; border-radius: 8px; background: 
        {% if severity == '–ö—Ä–∏—Ç–∏—á–Ω–∏–π' %}#ffebee
        {% elif severity == '–í–∞–∂–∫–∏–π' %}#fff3e0
        {% elif severity == '–°–µ—Ä–µ–¥–Ω—ñ–π' %}#e3f2fd
        {% else %}#e8f5e9{% endif %};"
      >
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: center;
          "
        >
          <div>
            <div
              style="font-weight: bold; color: 
            {% if severity == '–ö—Ä–∏—Ç–∏—á–Ω–∏–π' %}#c62828
            {% elif severity == '–í–∞–∂–∫–∏–π' %}#ef6c00
            {% elif severity == '–°–µ—Ä–µ–¥–Ω—ñ–π' %}#1565c0
            {% else %}#2e7d32{% endif %};"
            >
              {{ severity }}
            </div>
            <div style="font-size: 12px; color: #666; margin-top: 5px">
              {% widthratio count period_analysis.total_patients 100 %}% –≤—ñ–¥
              –∑–∞–≥–∞–ª—å–Ω–æ—ó
            </div>
          </div>
          <div
            style="font-size: 36px; font-weight: bold; color: 
          {% if severity == '–ö—Ä–∏—Ç–∏—á–Ω–∏–π' %}#c62828
          {% elif severity == '–í–∞–∂–∫–∏–π' %}#ef6c00
          {% elif severity == '–°–µ—Ä–µ–¥–Ω—ñ–π' %}#1565c0
          {% else %}#2e7d32{% endif %};"
          >
            {{ count }}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>


<div style="margin-bottom: 20px; margin-top: 30px;">
  {% if patient and patient.bracelet_id %}
    {# –ï—Å–ª–∏ –º—ã –ø—Ä–∏—à–ª–∏ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞ #}
    <a href="{% url 'patient_detail' patient.bracelet_id %}" style="text-decoration: none; color: #764ba2; font-weight: bold;">
      ‚Üê –ù–∞–∑–∞–¥ –¥–æ –∫–∞—Ä—Ç–∫–∏ –ø–∞—Ü—ñ—î–Ω—Ç–∞
    </a>
  {% else %}
    {# –ï—Å–ª–∏ —ç—Ç–æ –æ–±—â–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –≥–æ—Å–ø–∏—Ç–∞–ª—è #}
    <a href="{% url 'patient_list' %}" style="text-decoration: none; color: #764ba2; font-weight: bold;">
      ‚Üê –î–æ —Å–ø–∏—Å–∫—É –≤—Å—ñ—Ö –ø–∞—Ü—ñ—î–Ω—Ç—ñ–≤
    </a>
  {% endif %}
</div>

<h2 style="color: #2c3e50; margin-bottom: 10px">üìà –ê–Ω–∞–ª—ñ–∑ —á–∞—Å–æ–≤–∏—Ö —Ä—è–¥—ñ–≤</h2>
<h3 style="color: #7f8c8d; margin-bottom: 30px">
  {{ patient.full_name }} ({{ patient.bracelet_id }})
</h3>

{% if time_series_analysis %}

<div
  style="
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px;
    border-radius: 12px;
    margin-bottom: 30px;
    box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
  "
>
  <div
    style="
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    "
  >
    <div style="text-align: center">
      <div style="font-size: 14px; opacity: 0.9; margin-bottom: 5px">
        –ö—ñ–ª—å–∫—ñ—Å—Ç—å –≤–∏–º—ñ—Ä—é–≤–∞–Ω—å
      </div>
      <div style="font-size: 42px; font-weight: bold">
        {{ time_series_analysis.measurements_count }}
      </div>
    </div>
    <div style="text-align: center">
      <div style="font-size: 14px; opacity: 0.9; margin-bottom: 5px">
        –ü–µ—Ä—ñ–æ–¥ —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω–Ω—è
      </div>
      <div style="font-size: 42px; font-weight: bold">
        {{ time_series_analysis.time_span_hours|floatformat:1 }}
      </div>
      <div style="font-size: 14px; opacity: 0.9">–≥–æ–¥–∏–Ω</div>
    </div>
  </div>
</div>

<div
  style="
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  "
>
  <div
    style="
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    "
  >
    <div style="display: flex; align-items: center; margin-bottom: 15px">
      <div style="font-size: 36px; margin-right: 15px">‚ù§Ô∏è</div>
      <div>
        <h4 style="color: #2c3e50; margin: 0">–ü—É–ª—å—Å</h4>
        <p style="color: #7f8c8d; font-size: 12px; margin: 5px 0 0 0">
          Heart Rate (bpm)
        </p>
      </div>
    </div>

    <div
      style="
        background: #ffebee;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
      "
    >
      <div
        style="
          display: flex;
          justify-content: space-between;
          margin-bottom: 10px;
        "
      >
        <span style="font-size: 12px; color: #666">–°–µ—Ä–µ–¥–Ω—î:</span>
        <span style="font-weight: bold; color: #c62828; font-size: 18px">
          {{ time_series_analysis.statistics.heart_rate.mean|floatformat:1 }}
          bpm
        </span>
      </div>
      <div
        style="
          display: flex;
          justify-content: space-between;
          margin-bottom: 10px;
        "
      >
        <span style="font-size: 12px; color: #666">–ú—ñ–Ω - –ú–∞–∫—Å:</span>
        <span style="font-weight: bold; color: #c62828">
          {{ time_series_analysis.statistics.heart_rate.min }} - {{ time_series_analysis.statistics.heart_rate.max }}
        </span>
      </div>
      <div style="display: flex; justify-content: space-between">
        <span style="font-size: 12px; color: #666">–°—Ç. –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è:</span>
        <span style="font-weight: bold; color: #c62828">
          {{ time_series_analysis.statistics.heart_rate.std|floatformat:2 }}
        </span>
      </div>
    </div>

    <div style="padding: 15px; background: #f5f5f5; border-radius: 8px">
      <div style="font-size: 12px; color: #666; margin-bottom: 5px">
        –¢—Ä–µ–Ω–¥ (Linear Regression):
      </div>
      <div
        style="font-weight: bold; font-size: 18px; color: 
                {% if time_series_analysis.statistics.heart_rate.trend == 'increasing' %}#e74c3c
                {% elif time_series_analysis.statistics.heart_rate.trend == 'decreasing' %}#27ae60
                {% else %}#3498db{% endif %};"
      >
        {% if time_series_analysis.statistics.heart_rate.trend == 'increasing' %} 
          üìà –ó—Ä–æ—Å—Ç–∞—î 
        {% elif time_series_analysis.statistics.heart_rate.trend == 'decreasing' %} 
          üìâ –°–ø–∞–¥–∞—î 
        {% else %} 
          ‚û°Ô∏è –°—Ç–∞–±—ñ–ª—å–Ω–∏–π 
        {% endif %}
      </div>
    </div>
  </div>

  <div
    style="
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    "
  >
    <div style="display: flex; align-items: center; margin-bottom: 15px">
      <div style="font-size: 36px; margin-right: 15px">üå°Ô∏è</div>
      <div>
        <h4 style="color: #2c3e50; margin: 0">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</h4>
        <p style="color: #7f8c8d; font-size: 12px; margin: 5px 0 0 0">
          Body Temperature (¬∞C)
        </p>
      </div>
    </div>

    <div
      style="
        background: #e3f2fd;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
      "
    >
      <div
        style="
          display: flex;
          justify-content: space-between;
          margin-bottom: 10px;
        "
      >
        <span style="font-size: 12px; color: #666">–°–µ—Ä–µ–¥–Ω—î:</span>
        <span style="font-weight: bold; color: #1565c0; font-size: 18px">
          {{ time_series_analysis.statistics.temperature.mean|floatformat:1 }}¬∞C
        </span>
      </div>
      <div
        style="
          display: flex;
          justify-content: space-between;
          margin-bottom: 10px;
        "
      >
        <span style="font-size: 12px; color: #666">–ú—ñ–Ω - –ú–∞–∫—Å:</span>
        <span style="font-weight: bold; color: #1565c0">
          {{ time_series_analysis.statistics.temperature.min|floatformat:1 }} -
          {{ time_series_analysis.statistics.temperature.max|floatformat:1 }}
        </span>
      </div>
      <div style="display: flex; justify-content: space-between">
        <span style="font-size: 12px; color: #666">–°—Ç. –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è:</span>
        <span style="font-weight: bold; color: #1565c0">
          {{ time_series_analysis.statistics.temperature.std|floatformat:2 }}
        </span>
      </div>
    </div>

    <div style="padding: 15px; background: #f5f5f5; border-radius: 8px">
      <div style="font-size: 12px; color: #666; margin-bottom: 5px">
        –¢—Ä–µ–Ω–¥ (Linear Regression):
      </div>
      <div
        style="font-weight: bold; font-size: 18px; color: 
                {% if time_series_analysis.statistics.temperature.trend == 'increasing' %}#e74c3c
                {% elif time_series_analysis.statistics.temperature.trend == 'decreasing' %}#27ae60
                {% else %}#3498db{% endif %};"
      >
        {% if time_series_analysis.statistics.temperature.trend == 'increasing'%} 
          üìà –ó—Ä–æ—Å—Ç–∞—î 
        {% elif time_series_analysis.statistics.temperature.trend == 'decreasing' %} 
          üìâ –°–ø–∞–¥–∞—î 
        {% else %} 
          ‚û°Ô∏è –°—Ç–∞–±—ñ–ª—å–Ω–∏–π 
        {% endif %}
      </div>
    </div>
  </div>

  <div
    style="
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    "
  >
    <div style="display: flex; align-items: center; margin-bottom: 15px">
      <div style="font-size: 36px; margin-right: 15px">üí®</div>
      <div>
        <h4 style="color: #2c3e50; margin: 0">–°–∞—Ç—É—Ä–∞—Ü—ñ—è O‚ÇÇ</h4>
        <p style="color: #7f8c8d; font-size: 12px; margin: 5px 0 0 0">
          Oxygen Saturation (%)
        </p>
      </div>
    </div>

    <div
      style="
        background: #e8f5e9;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
      "
    >
      <div
        style="
          display: flex;
          justify-content: space-between;
          margin-bottom: 10px;
        "
      >
        <span style="font-size: 12px; color: #666">–°–µ—Ä–µ–¥–Ω—î:</span>
        <span style="font-weight: bold; color: #2e7d32; font-size: 18px">
          {{time_series_analysis.statistics.oxygen_saturation.mean|floatformat:1}}%
        </span>
      </div>
      <div
        style="
          display: flex;
          justify-content: space-between;
          margin-bottom: 10px;
        "
      >
        <span style="font-size: 12px; color: #666">–ú—ñ–Ω - –ú–∞–∫—Å:</span>
        <span style="font-weight: bold; color: #2e7d32">
          {{ time_series_analysis.statistics.oxygen_saturation.min }} - {{time_series_analysis.statistics.oxygen_saturation.max }}
        </span>
      </div>
      <div style="display: flex; justify-content: space-between">
        <span style="font-size: 12px; color: #666">–°—Ç. –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è:</span>
        <span style="font-weight: bold; color: #2e7d32">
          {{ time_series_analysis.statistics.oxygen_saturation.std|floatformat:2}}
        </span>
      </div>
    </div>

    <div style="padding: 15px; background: #f5f5f5; border-radius: 8px">
      <div style="font-size: 12px; color: #666; margin-bottom: 5px">
        –¢—Ä–µ–Ω–¥ (Linear Regression):
      </div>
      <div
        style="font-weight: bold; font-size: 18px; color: 
                      {% if time_series_analysis.statistics.oxygen_saturation.trend == 'increasing' %}#27ae60
                      {% elif time_series_analysis.statistics.oxygen_saturation.trend == 'decreasing' %}#e74c3c
                      {% else %}#3498db{% endif %};"
      >
        {% if time_series_analysis.statistics.oxygen_saturation.trend == 'increasing' %} 
          üìà –ó—Ä–æ—Å—Ç–∞—î 
        {% elif time_series_analysis.statistics.oxygen_saturation.trend == 'decreasing'
        %} 
          üìâ –°–ø–∞–¥–∞—î (—É–≤–∞–≥–∞!) 
        {% else %} 
          ‚û°Ô∏è –°—Ç–∞–±—ñ–ª—å–Ω–∏–π 
        {% endif %}
      </div>
    </div>
  </div>

  <div
    style="
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    "
  >
    <div style="display: flex; align-items: center; margin-bottom: 15px">
      <div style="font-size: 36px; margin-right: 15px">ü©∫</div>
      <div>
        <h4 style="color: #2c3e50; margin: 0">–ê—Ä—Ç–µ—Ä—ñ–∞–ª—å–Ω–∏–π —Ç–∏—Å–∫</h4>
        <p style="color: #7f8c8d; font-size: 12px; margin: 5px 0 0 0">
          Blood Pressure (mmHg)
        </p>
      </div>
    </div>

    <div style="background: #f3e5f5; padding: 15px; border-radius: 8px">
      <div
        style="
          display: flex;
          justify-content: space-between;
          margin-bottom: 10px;
        "
      >
        <span style="font-size: 12px; color: #666"
          >–°–∏—Å—Ç–æ–ª—ñ—á–Ω–∏–π (—Å–µ—Ä–µ–¥–Ω—ñ–π):</span
        >
        <span style="font-weight: bold; color: #7b1fa2; font-size: 18px">
          {{ time_series_analysis.statistics.blood_pressure.sys_mean|floatformat:1 }}
        </span>
      </div>
      <div style="display: flex; justify-content: space-between">
        <span style="font-size: 12px; color: #666"
          >–î—ñ–∞—Å—Ç–æ–ª—ñ—á–Ω–∏–π (—Å–µ—Ä–µ–¥–Ω—ñ–π):</span
        >
        <span style="font-weight: bold; color: #7b1fa2; font-size: 18px">
          {{ time_series_analysis.statistics.blood_pressure.dia_mean|floatformat:1 }}
        </span>
      </div>
    </div>
  </div>
</div>

{% if time_series_analysis.anomalies %}
<div
  style="
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    color: white;
    padding: 30px;
    border-radius: 12px;
    margin-bottom: 30px;
    box-shadow: 0 10px 30px rgba(240, 147, 251, 0.3);
  "
>
  <h3 style="margin-bottom: 20px; display: flex; align-items: center">
    <span style="font-size: 32px; margin-right: 10px">‚ö†Ô∏è</span>
    –í–∏—è–≤–ª–µ–Ω—ñ –∞–Ω–æ–º–∞–ª—ñ—ó
  </h3>
  <p style="opacity: 0.9; margin-bottom: 20px; font-size: 14px">
    –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–∏–π –º–µ—Ç–æ–¥ –≤–∏—è–≤–ª–µ–Ω–Ω—è –≤–∏–∫–∏–¥—ñ–≤ (¬±2œÉ –≤—ñ–¥ —Å–µ—Ä–µ–¥–Ω—å–æ–≥–æ)
  </p>

  <div style="display: grid; gap: 15px">
    {% for anomaly in time_series_analysis.anomalies %}
    <div
      style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); padding: 20px; border-radius: 8px; border-left: 4px solid 
              {% if anomaly.severity == 'critical' %}#ff1744
              {% elif anomaly.severity == 'high' %}#ff6f00
              {% elif anomaly.severity == 'warning' %}#ffd600
              {% else %}#00e676{% endif %};"
    >
      <div
        style="
          display: flex;
          justify-content: space-between;
          align-items: start;
          margin-bottom: 10px;
        "
      >
        <div>
          <div style="font-weight: bold; font-size: 16px; margin-bottom: 5px">
            {% if anomaly.type == 'heart_rate' %}‚ù§Ô∏è –ü—É–ª—å—Å {% elif anomaly.type
            == 'temperature' %}üå°Ô∏è –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ {% elif anomaly.type == 'oxygen'
            %}üí® –ö–∏—Å–µ–Ω—å {% endif %}
          </div>
          <div style="font-size: 12px; opacity: 0.9">
            {{ anomaly.timestamp|slice:":10" }} {{
            anomaly.timestamp|slice:"11:16" }}
          </div>
        </div>
        <div style="text-align: right">
          <div style="font-size: 28px; font-weight: bold">
            {{ anomaly.value }}{% if anomaly.type == 'temperature' %}¬∞C{% elif
            anomaly.type == 'oxygen' %}%{% else %} bpm{% endif %}
          </div>
          <div
            style="
              font-size: 12px;
              padding: 4px 8px;
              background: rgba(255, 255, 255, 0.3);
              border-radius: 4px;
              margin-top: 5px;
            "
          >
            {% if anomaly.severity == 'critical' %}üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ {% elif
            anomaly.severity == 'high' %}üü† –í–∏—Å–æ–∫–∏–π {% elif anomaly.severity ==
            'warning' %}üü° –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è {% else %}üü¢ –ù–∏–∑—å–∫–∏–π {% endif %}
          </div>
        </div>
      </div>
      <div style="font-size: 13px; opacity: 0.9">
        {% if anomaly.type == 'heart_rate' %} 
          {% if anomaly.severity == 'high'%}
            –¢–∞—Ö—ñ–∫–∞—Ä–¥—ñ—è - –ø—É–ª—å—Å –≤–∏—â–µ –Ω–æ—Ä–º–∏
          {% else %}
            –ë—Ä–∞–¥–∏–∫–∞—Ä–¥—ñ—è - –ø—É–ª—å—Å –Ω–∏–∂—á–µ –Ω–æ—Ä–º–∏
          {% endif %} 
        {% elif anomaly.type == 'temperature' %} 
          {% if anomaly.severity == 'high' %}
            –ì–∞—Ä—è—á–∫–∞ - –ø—ñ–¥–≤–∏—â–µ–Ω–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
          {% else %}
            –ì—ñ–ø–æ—Ç–µ—Ä–º—ñ—è - –∑–Ω–∏–∂–µ–Ω–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞
          {% endif %} 
        {% elif anomaly.type == 'oxygen' %} 
          {% if anomaly.severity == 'critical' %}
            –ö—Ä–∏—Ç–∏—á–Ω–∞ –≥—ñ–ø–æ–∫—Å—ñ—è - –Ω–µ–≥–∞–π–Ω–∞ –¥–æ–ø–æ–º–æ–≥–∞!
          {% else %}
            –ü–æ–º—ñ—Ä–Ω–∞ –≥—ñ–ø–æ–∫—Å—ñ—è - –ø–æ—Ç—Ä—ñ–±–µ–Ω –∫–æ–Ω—Ç—Ä–æ–ª—å
          {% endif %} 
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% else %}
<div
  style="
    background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%);
    padding: 30px;
    border-radius: 12px;
    margin-bottom: 30px;
    text-align: center;
  "
>
  <div style="font-size: 48px; margin-bottom: 10px">‚úÖ</div>
  <h3 style="color: #1b5e20; margin-bottom: 10px">–ê–Ω–æ–º–∞–ª—ñ–π –Ω–µ –≤–∏—è–≤–ª–µ–Ω–æ</h3>
  <p style="color: #2e7d32">–í—Å—ñ –∂–∏—Ç—Ç—î–≤—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏ –≤ –º–µ–∂–∞—Ö –Ω–æ—Ä–º–∏</p>
</div>
{% endif %}

<div
  style="
    background: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  "
>
  <h3 style="margin-bottom: 20px; color: #2c3e50">üìã –Ü—Å—Ç–æ—Ä—ñ—è –≤–∏–º—ñ—Ä—é–≤–∞–Ω—å</h3>
  <div style="overflow-x: auto">
    <table style="width: 100%; border-collapse: collapse">
      <thead>
        <tr
          style="
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
          "
        >
          <th style="padding: 12px; text-align: left">–ß–∞—Å</th>
          <th style="padding: 12px; text-align: center">‚ù§Ô∏è –ü—É–ª—å—Å</th>
          <th style="padding: 12px; text-align: center">üå°Ô∏è –¢–µ–º–ø.</th>
          <th style="padding: 12px; text-align: center">ü©∫ –¢–∏—Å–∫</th>
          <th style="padding: 12px; text-align: center">üí® O‚ÇÇ</th>
          <th style="padding: 12px; text-align: center">–°—Ç–∞—Ç—É—Å</th>
        </tr>
      </thead>
      <tbody>
        {% for vital in vital_signs %}
        <tr style="border-bottom: 1px solid #e0e0e0">
          <td style="padding: 12px">{{ vital.timestamp|date:"d.m.Y H:i" }}</td>
          <td
            style="padding: 12px; text-align: center; font-weight: bold; color: 
                    {% if vital.heart_rate > 100 or vital.heart_rate < 60 %}#e74c3c
                    {% else %}#27ae60{% endif %};"
          >
            {{ vital.heart_rate }}
          </td>
          <td
            style="padding: 12px; text-align: center; font-weight: bold; color: 
                    {% if vital.temperature > 37.5 or vital.temperature < 36.0 %}#e74c3c
                    {% else %}#27ae60{% endif %};"
          >
            {{ vital.temperature }}
          </td>
          <td style="padding: 12px; text-align: center; font-weight: bold">
            {{ vital.blood_pressure_sys }}/{{ vital.blood_pressure_dia }}
          </td>
          <td
            style="padding: 12px; text-align: center; font-weight: bold; color: 
                    {% if vital.oxygen_saturation < 95 %}#e74c3c
                    {% else %}#27ae60{% endif %};"
          >
            {{ vital.oxygen_saturation }}%
          </td>
          <td style="padding: 12px; text-align: center">
            {% if vital.heart_rate > 100 or vital.heart_rate < 60 or vital.temperature > 37.5 or vital.oxygen_saturation < 95 %}
            <span
              style="
                background: #ffebee;
                color: #c62828;
                padding: 4px 8px;
                border-radius: 12px;
                font-size: 11px;
              "
            >
              ‚ö†Ô∏è –£–≤–∞–≥–∞
            </span>
            {% else %}
            <span
              style="
                background: #e8f5e9;
                color: #2e7d32;
                padding: 4px 8px;
                border-radius: 12px;
                font-size: 11px;
              "
            >
              ‚úì –ù–æ—Ä–º–∞
            </span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% else %}
<div
  style="
    background: #fff3cd;
    padding: 40px;
    border-radius: 12px;
    text-align: center;
  "
>
  <div style="font-size: 48px; margin-bottom: 15px">üìä</div>
  <h3 style="color: #856404; margin-bottom: 10px">
    –ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–∞–Ω–∏—Ö –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É
  </h3>
  <p style="color: #856404">
    {% if patient %}
      –î–æ–¥–∞–π—Ç–µ –∂–∏—Ç—Ç—î–≤—ñ –ø–æ–∫–∞–∑–Ω–∏–∫–∏ –¥–ª—è –ø–∞—Ü—ñ—î–Ω—Ç–∞, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –∞–Ω–∞–ª—ñ–∑ —á–∞—Å–æ–≤–∏—Ö —Ä—è–¥—ñ–≤
    {% else %}
      –£ —Å–∏—Å—Ç–µ–º—ñ –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–∞–Ω–∏—Ö –ø—Ä–æ –ø–∞—Ü—ñ—î–Ω—Ç—ñ–≤ –¥–ª—è —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è –∑–≤—ñ—Ç—É.
    {% endif %}
  </p>
  {% if patient and patient.bracelet_id %}
  <a
    href="{% url 'patient_detail' patient.bracelet_id %}"
    style="
      display: inline-block;
      margin-top: 20px;
      padding: 12px 24px;
      background: #f39c12;
      color: white;
      text-decoration: none;
      border-radius: 6px;
      font-weight: bold;
    "
  >
    –î–æ–¥–∞—Ç–∏ –ø–æ–∫–∞–∑–Ω–∏–∫–∏
  </a>
  {% else %}
  <a
    href="{% url 'patient_list' %}"
    style="
      display: inline-block;
      margin-top: 20px;
      padding: 12px 24px;
      background: #7f8c8d;
      color: white;
      text-decoration: none;
      border-radius: 6px;
      font-weight: bold;
    "
  >
    –î–æ —Å–ø–∏—Å–∫—É –ø–∞—Ü—ñ—î–Ω—Ç—ñ–≤
  </a>
  {% endif %}
</div>

{% if patient and patient.bracelet_id %}
<div style="margin-top: 30px; text-align: center">
  <a
    href="{% url 'patient_time_series' patient.bracelet_id %}"
    style="
      display: inline-block;
      padding: 15px 30px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      transition: all 0.3s;
    "
  >
    üìà –ê–Ω–∞–ª—ñ–∑ —á–∞—Å–æ–≤–∏—Ö —Ä—è–¥—ñ–≤ –¥–ª—è {{ patient.full_name }}
  </a>
</div>
{% endif %}
{% endif %}
{% endblock %}
